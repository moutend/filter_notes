# Lookahead Limiter の記事の訳
以下は原文へのリンクです。訳文は Markdown のフォーマットに整形しています。

- [Lookahead Limiter — Musicdsp.org documentation](https://www.musicdsp.org/en/latest/Effects/274-lookahead-limiter.html)

## 訳
### 材料:
- 1 つのリングバッファ (先読み時間の長さ)
- 2 つのリングバッファ (先読み時間の半分の長さ)
- 4 つのパラメータ (「先読み時間 \[s\] 」、「入力ゲイン \[dB\] 」、「出力ゲイン \[dB\] 」、「リリース時間 \[s\] 」)
- 一握りの状態変数

### レシピ:
0. 全てのバッファが適切に初期化されて 1 つのゴミデータも含まないようにする (純粋な 0 埋めが必要) 。

各サンプルについて以下の処理を行う:

1. 後で使うために、現在のサンプルを先読み時間のリングバッファに格納する (そして前段「出力」として抜け落ちてくる値を取得する)

2. このリングバッファ内の最大値を探す。これはホールドアルゴリズムで効率よく実装することもできる。

3. 「入力ゲイン \[dB\] 」パラメータによって、この最大値にゲインをかける

4. 必要なゲインリダクション係数を計算する (もしゲインリダクションが起こらないなら =1 、あらゆる 0 dBFS を超える信号については <1)

5. よりよい数値的な安定性のために、この値を 1 から引く。 (**後で必ず元に戻すこと！**)

6. 短時間の合計を計算するために、このゲインリダクションの値を 1 つ目の小さいほうのリングバッファに加える (この値を合計に加算して、リングバッファから抜け落ちた値を減算する) 。

7. 合計をリングバッファの長さで割って正規化する (-> / (「先読み時間 \[samples\] 」 / 2))

8. この合計を使って 2 つ目のリングバッファで手順 6 と 7 を繰り返す。これらの手順の理由はディラックのインパルスを三角形に変換すること (ディラック -> 矩形 -> 三角形)

9. リリース時間 (リリース時間 -> リリーススルーレート「係数」 -> その係数で乗算) を「最大ゲインリダクション」状態変数に適用する

10. 今、計算されたゲインリダクションが「最大ゲインリダクション」より高いかをチェックする。もしそうなら入れ替えろ！

11. 手順 5 の (1 - x) をここで除去する

12. 入力から得られた上記の値と出力のゲインから実効ゲインリダクションを計算する。

13. このゲインリダクションを手順 1 の前段「出力」に適用する

全てのサンプルに上の処理 (手順 1-13) を繰り返せ！

## 訳注
- dirt -> ゴミデータ
  - 初期化されていない配列のデータはゴミと呼ばれることがある。
- preliminary -> 前段
  - preliminary は「事前に必要となる」というような意味 ([Merriam-Webster](https://www.merriam-webster.com/dictionary/preliminary)) 。 the lookahead time circular buffer から出力された値はゲインを掛け合わせてリミッタの出力になるので、文脈から前段「出力」とした。
- 手順 6 の felt out は fell out の誤字と判断した。

## その他
手順 5 と 11 は誤差が減らずにエッジケースが増えるので、実装することはお勧めしません。この誤差について調べたことを以下のリンク先に掲載しています。

- [ステップ応答が S 字を描くフィルタ - 補足](../s_curve_step_response_filter/s_curve_step_response_filter.html#補足)
