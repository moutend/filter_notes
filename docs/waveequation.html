<!doctype html><html><head><meta charset='utf-8'>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.4.1/github-markdown.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.8.3/katex.min.css">
<link rel="stylesheet" href="https://gitcdn.xyz/repo/goessner/mdmath/master/css/texmath.css">
<link rel="stylesheet" href="https://gitcdn.xyz/repo/goessner/mdmath/master/css/vscode-texmath.css">

</head><body class="markdown-body">
<style>
body {
  max-width: 704px;
  margin: auto;
  padding: 32px 8px;
}

canvas {
  /* image-rendering: pixelated; */
  display: inline-block;
  border-style: solid;
  border-width: 0.2px;
  border-color: #000000;
}

input[type="button"] {
  display: block;
}

.numberInputLabel {
  display: inline-block;
  text-align: right;
  width: 160px;
  margin: 0 8px 0 0;
  padding-right: 8px;
  border-right: solid 3px #606060;
}

.numberInputRange {
  display: inline-block;
  max-width: 220px;
  width: 50%;
  margin: 0 8px 0 0;
}

.numberInputNumber {
  display: inline-block;
  max-width: 100px;
  width: 20%;
  margin: 0;
}

code {
  overflow-x: scroll;
  overflow-y: hidden;
  white-space: pre;
}

.katex {
  font-size: 1.3em !important;
}
</style>
<h1 data-line="53" class="code-line" id="%E6%B3%A2%E3%81%AE%E3%82%B7%E3%83%9F%E3%83%A5%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">波のシミュレーション</h1>
<p data-line="54" class="code-line"><a href="https://en.wikipedia.org/wiki/Wave_equation">波動方程式</a>をコンピュータで計算できる形に変形します。</p>
<h2 data-line="56" class="code-line" id="%E6%B3%A2%E5%8B%95%E6%96%B9%E7%A8%8B%E5%BC%8F">波動方程式</h2>
<p data-line="57" class="code-line">波は波動方程式で表すことができます。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup><msup><mi mathvariant="normal">∇</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">
\frac{\partial^2 u(\vec{x},\,t)}{\partial t^2} = c^2 \nabla^2 u(\vec{x},\,t)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.491108em;"></span><span class="strut bottom" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathrm">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span></span></span></span></span></eqn></section><p data-line="63" class="code-line"><eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>(</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover><mo separator="true">,</mo><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">u(\vec{x}, t)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span></span></eq> は、<a href="https://en.wikipedia.org/wiki/Scalar_field">場 </a><eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">u</span></span></span></span></eq> の地点 <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover></mrow><annotation encoding="application/x-tex">\vec{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.71444em;"></span><span class="strut bottom" style="height:0.71444em;vertical-align:0em;"></span><span class="base"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span></span></span></span></eq> 、時点 <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.61508em;"></span><span class="strut bottom" style="height:0.61508em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">t</span></span></span></span></eq> における値です。</p>
<p data-line="65" class="code-line"><eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">c</span></span></span></span></eq> は波の伝わる速度です。</p>
<h2 data-line="67" class="code-line" id="1%E6%AC%A1%E5%85%83%E3%81%AE%E6%B3%A2">1次元の波</h2>
<p data-line="68" class="code-line">1次元の波について考えます。</p>
<p data-line="70" class="code-line">波の次元が変わると<a href="https://en.wikipedia.org/wiki/Laplace_operator">ラプラシアン</a> <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="normal">∇</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">\nabla^2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8141079999999999em;"></span><span class="strut bottom" style="height:0.8141079999999999em;vertical-align:0em;"></span><span class="base"><span class="mord"><span class="mord mathrm">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></eq> の展開形が変わります。 <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">n</span></span></span></span></eq> 次元のラプラシアンは次のように書けます。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi mathvariant="normal">∇</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo><mo>=</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>0</mn></mrow><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></munderover><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>⃗</mo></mover><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msubsup><mi>x</mi><mi>i</mi><mn>2</mn></msubsup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\nabla^2u(\vec{x},\,t) = \sum_{i = 0}^{n - 1} \frac{\partial^2 u(\vec{x},\,t)}{\partial x_i^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.8011130000000004em;"></span><span class="strut bottom" style="height:3.0787820000000004em;vertical-align:-1.277669em;"></span><span class="base"><span class="mord"><span class="mord mathrm">∇</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span><span class="mrel">=</span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.8011130000000004em;"><span style="top:-1.872331em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">i</span><span class="mrel mtight">=</span><span class="mord mathrm mtight">0</span></span></span></span><span style="top:-3.050005em;"><span class="pstrut" style="height:3.05em;"></span><span><span class="mop op-symbol large-op">∑</span></span></span><span style="top:-4.300005em;margin-left:0em;"><span class="pstrut" style="height:3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mbin mtight">−</span><span class="mord mathrm mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.277669em;"></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.7959080000000001em;"><span style="top:-2.4231360000000004em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathit mtight">i</span></span></span><span style="top:-3.0448000000000004em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.27686399999999994em;"></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.71444em;"><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="accent-body accent-vec" style="margin-left:0.05556em;"><span>⃗</span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.9628639999999999em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></eqn></section><p data-line="76" class="code-line"><eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n=1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.64444em;"></span><span class="strut bottom" style="height:0.64444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">n</span><span class="mrel">=</span><span class="mord mathrm">1</span></span></span></span></eq> としたときの波動方程式です。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>t</mi><mn>2</mn></msup></mrow></mfrac><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup><mfrac><mrow><msup><mi mathvariant="normal">∂</mi><mn>2</mn></msup><mi>u</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mspace width="0.16667em"></mspace><mi>t</mi><mo>)</mo></mrow><mrow><mi mathvariant="normal">∂</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">
\frac{\partial^2 u(x,\,t)}{\partial t^2} = c^2 \frac{\partial^2 u(x,\,t)}{\partial x^2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:1.491108em;"></span><span class="strut bottom" style="height:2.177108em;vertical-align:-0.686em;"></span><span class="base"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathrm" style="margin-right:0.05556em;">∂</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit"><span class="mspace thinspace"></span><span class="mord mathit">t</span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></eqn></section><h2 data-line="82" class="code-line" id="%E6%9C%89%E9%99%90%E5%B7%AE%E5%88%86%E6%B3%95">有限差分法</h2>
<p data-line="83" class="code-line"><a href="https://en.wikipedia.org/wiki/Finite_difference_method">有限差分法</a>は微分方程式を計算できる形にする方法の一つです。</p>
<p data-line="85" class="code-line"><a href="http://www.sympy.org/en/index.html">SymPy</a>の <a href="http://docs.sympy.org/latest/tutorial/calculus.html?highlight=as_finite_difference#finite-differences"><code>as_finite_difference</code></a> を使って1次元の波動方程式を<a href="https://en.wikipedia.org/wiki/Finite_difference">有限差分</a>の形に変えます。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">from</span> sympy <span class="hljs-keyword">import</span> *

c, t, u, x, dx, dt = symbols(<span class="hljs-string">'c t u x dx dt'</span>)

u_xt = u(x, t)
u_dx2 = u_xt.diff(x, x).as_finite_difference(dx)
u_dt2 = u_xt.diff(t, t).as_finite_difference(dt)

eq = Eq(u_dt2, c**<span class="hljs-number">2</span> * u_dx2)
ans = solve(eq, u(x, t + dt))

latex(expand(ans[<span class="hljs-number">0</span>]))
</div></code></pre>
<p data-line="102" class="code-line">出力された式です。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>u</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo>+</mo><mi>d</mi><mi>t</mi><mo>)</mo><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>−</mo><mfrac><mrow><mn>2</mn><msup><mi>c</mi><mn>2</mn></msup></mrow><mrow><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo>+</mo><mfrac><mrow><msup><mi>c</mi><mn>2</mn></msup><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow><mrow><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mo>−</mo><mi>d</mi><mi>x</mi><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo>+</mo><mfrac><mrow><msup><mi>c</mi><mn>2</mn></msup><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow><mrow><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>d</mi><mi>x</mi><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>+</mo><mn>2</mn><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo>−</mo><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mo>−</mo><mi>d</mi><mi>t</mi><mo>+</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">
\begin{aligned}
u(x,t + dt) = &amp;- \frac{2 c^{2}}{dx^{2}} dt^{2} u{\left (x,t \right )} + \frac{c^{2} dt^{2}}{dx^{2}} u{\left (- dx + x,t \right )} + \frac{c^{2} dt^{2}}{dx^{2}} u{\left (dx + x,t \right )}\\
&amp;+ 2 u{\left (x,t \right )} - u{\left (x,- dt + t \right )}
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.238554em;"></span><span class="strut bottom" style="height:3.9771080000000003em;vertical-align:-1.7385540000000002em;"></span><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.238554em;"><span style="top:-4.238554em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mclose">)</span><span class="mrel">=</span></span></span><span style="top:-2.412554em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.7385540000000002em;"></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.238554em;"><span style="top:-4.238554em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mbin">−</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathrm">2</span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mbin">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">−</span><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mbin">+</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span style="top:-2.412554em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mbin">+</span><span class="mord mathrm">2</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mbin">−</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord">−</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.7385540000000002em;"></span></span></span></span></span></span></span></span></span></span></eqn></section><p data-line="111" class="code-line">式を整理します。</p>
<section><eqn><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>u</mi><mo>(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo>+</mo><mi>d</mi><mi>t</mi><mo>)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>α</mi><mrow><mo fence="true">(</mo><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mo>−</mo><mi>d</mi><mi>x</mi><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo>+</mo><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>d</mi><mi>x</mi><mo>+</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo fence="true">)</mo></mrow><mo>+</mo><mi>β</mi><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow><mo>−</mo><mi>u</mi><mrow><mrow><mo fence="true">(</mo><mi>x</mi><mo separator="true">,</mo><mo>−</mo><mi>d</mi><mi>t</mi><mo>+</mo><mi>t</mi><mo fence="true">)</mo></mrow></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>α</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><msup><mi>c</mi><mn>2</mn></msup><mfrac><mrow><mi>d</mi><msup><mi>t</mi><mn>2</mn></msup></mrow><mrow><mi>d</mi><msup><mi>x</mi><mn>2</mn></msup></mrow></mfrac></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mn>2</mn><mrow><mo fence="true">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo fence="true">)</mo></mrow></mrow></mstyle></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">
\begin{aligned}
u(x,t + dt) &amp;= \alpha \left(u{\left (- dx + x,t \right )} + u{\left (dx + x,t \right )}\right)
+ \beta u{\left (x,t \right )} - u{\left (x,- dt + t \right )}\\

\alpha &amp;= c^{2} \frac{dt^{2}}{dx^{2}}\\
\beta &amp;= 2 \left(1 - \alpha \right)
\end{aligned}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:2.9885540000000006em;"></span><span class="strut bottom" style="height:5.477108000000001em;vertical-align:-2.488554000000001em;"></span><span class="base"><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.9885540000000006em;"><span style="top:-5.639662000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span><span style="top:-3.4885539999999997em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.0037em;">α</span></span></span><span style="top:-1.6625539999999992em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord mathit" style="margin-right:0.05278em;">β</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.488554000000001em;"></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:2.9885540000000006em;"><span style="top:-5.639662000000001em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mrel">=</span><span class="mord mathit" style="margin-right:0.0037em;">α</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord">−</span><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mbin">+</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mclose delimcenter" style="top:0em;">)</span></span><span class="mbin">+</span><span class="mord mathit" style="margin-right:0.05278em;">β</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span><span class="mbin">−</span><span class="mord mathit">u</span><span class="mord"><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord">−</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mbin">+</span><span class="mord mathit">t</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span style="top:-3.4885539999999997em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mrel">=</span><span class="mord"><span class="mord mathit">c</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8641079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.491108em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.740108em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathit">d</span><span class="mord"><span class="mord mathit">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span style="top:-1.6625539999999992em;"><span class="pstrut" style="height:3.491108em;"></span><span class="mord"><span class="mord"></span><span class="mrel">=</span><span class="mord mathrm">2</span><span class="minner"><span class="mopen delimcenter" style="top:0em;">(</span><span class="mord mathrm">1</span><span class="mbin">−</span><span class="mord mathit" style="margin-right:0.0037em;">α</span><span class="mclose delimcenter" style="top:0em;">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.488554000000001em;"></span></span></span></span></span></span></span></span></span></span></eqn></section><p data-line="123" class="code-line">計算できる形になりました。実装します。</p>
<pre class="hljs"><code><div><span class="hljs-comment">// u(x, t) -&gt; wave[t][x]</span>
<span class="hljs-keyword">var</span> wave = []
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; ++i) {
  wave.push(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">512</span>).fill(<span class="hljs-number">0</span>))
}

<span class="hljs-keyword">var</span> c = <span class="hljs-number">4</span>       <span class="hljs-comment">// 波の速度 : m/s</span>
<span class="hljs-keyword">var</span> dt = <span class="hljs-number">1</span> / <span class="hljs-number">60</span> <span class="hljs-comment">// 1ステップの時間 : 秒</span>
<span class="hljs-keyword">var</span> dx = <span class="hljs-number">0.1</span>    <span class="hljs-comment">// wave の要素間の距離 : メートル</span>

<span class="hljs-keyword">var</span> alpha = (c * dt / dx)**<span class="hljs-number">2</span>
<span class="hljs-keyword">var</span> beta = <span class="hljs-number">2</span> * (<span class="hljs-number">1</span> - alpha)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span>(<span class="hljs-params"></span>) </span>{
  wave.unshift(wave.pop())

  <span class="hljs-comment">// 固定端。wave[t][0] と wave [t][last] は 0 で固定。</span>
  <span class="hljs-keyword">var</span> last = wave[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>; x &lt; last; ++x) {
    wave[<span class="hljs-number">0</span>][x] = alpha * (wave[<span class="hljs-number">1</span>][x + <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][x - <span class="hljs-number">1</span>])
      + beta * wave[<span class="hljs-number">1</span>][x]
      - wave[<span class="hljs-number">2</span>][x]
  }
}
</div></code></pre>
<p data-line="152" class="code-line">ここでは <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi></mrow><annotation encoding="application/x-tex">u</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">u</span></span></span></span></eq> を配列 <code>wave</code> として実装しています。配列 <code>wave</code> のインデックスは <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">t</span></span></span></span></eq> や <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">dx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">x</span></span></span></span></eq> の係数として考えることができます。例えば <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>u</mi><mo>(</mo><mi>x</mi><mo>+</mo><mn>3</mn><mi>d</mi><mi>x</mi><mo separator="true">,</mo><mi>t</mi><mo>−</mo><mn>2</mn><mi>d</mi><mi>t</mi><mo>)</mo></mrow><annotation encoding="application/x-tex">u(x + 3dx, t - 2dt)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base"><span class="mord mathit">u</span><span class="mopen">(</span><span class="mord mathit">x</span><span class="mbin">+</span><span class="mord mathrm">3</span><span class="mord mathit">d</span><span class="mord mathit">x</span><span class="mpunct">,</span><span class="mord mathit">t</span><span class="mbin">−</span><span class="mord mathrm">2</span><span class="mord mathit">d</span><span class="mord mathit">t</span><span class="mclose">)</span></span></span></span></eq> なら <code>wave[t - 2][x + 3]</code> と書きかえられます。</p>
<p data-line="154" class="code-line">上のコードのままでは波に力を加えていないので動きません。適当に動かしてみてください。</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">move</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// 波を適当に動かす。</span>
  wave[<span class="hljs-number">0</span>][<span class="hljs-built_in">Math</span>.floor(wave[<span class="hljs-number">0</span>].length / <span class="hljs-number">2</span>)] = <span class="hljs-number">0.01</span> * <span class="hljs-built_in">Math</span>.sin(<span class="hljs-built_in">Date</span>.now() * <span class="hljs-number">1e-3</span>)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">draw</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-comment">// canvas などに描画。ここでは省略。</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">animate</span>(<span class="hljs-params"></span>) </span>{
  draw()
  step()
  move()
  requestAnimationFrame(animate)
}
</div></code></pre>
<h2 data-line="174" class="code-line" id="%E5%A2%83%E7%95%8C%E6%9D%A1%E4%BB%B6">境界条件</h2>
<p data-line="175" class="code-line">固定端、自由端、輪について見ていきます。</p>
<p data-line="177" class="code-line">固定端のときは端を定数で固定します。</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span>(<span class="hljs-params"></span>) </span>{
  wave.unshift(wave.pop())

  <span class="hljs-comment">// wave[0][0] と wave[0][last] に定数を入れておく。</span>
  <span class="hljs-keyword">var</span> last = wave[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>; x &lt; last; ++x) {
    wave[<span class="hljs-number">0</span>][x] = alpha * (wave[<span class="hljs-number">1</span>][x + <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][x - <span class="hljs-number">1</span>])
      + beta * wave[<span class="hljs-number">1</span>][x]
      - wave[<span class="hljs-number">2</span>][x]
  }
}
</div></code></pre>
<p data-line="193" class="code-line">自由端のときは、橋の値に、端の一つ内側の値を使います。</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span>(<span class="hljs-params"></span>) </span>{
  wave.unshift(wave.pop())

  <span class="hljs-keyword">var</span> last = wave[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>

  <span class="hljs-comment">// 何度も繰り返すので for の中に if を入れることを避ける。</span>
  wave[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = alpha * (wave[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])
    + beta * wave[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]
    - wave[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]

  wave[<span class="hljs-number">0</span>][last] = alpha * (wave[<span class="hljs-number">1</span>][last - <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][last - <span class="hljs-number">1</span>])
    + beta * wave[<span class="hljs-number">1</span>][last]
    - wave[<span class="hljs-number">2</span>][last]

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>; x &lt; last; ++x) {
    wave[<span class="hljs-number">0</span>][x] = alpha * (wave[<span class="hljs-number">1</span>][x + <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][x - <span class="hljs-number">1</span>])
      + beta * wave[<span class="hljs-number">1</span>][x]
      - wave[<span class="hljs-number">2</span>][x]
  }
}
</div></code></pre>
<p data-line="218" class="code-line">輪のときは端と端をつなぎます。</p>
<pre class="hljs"><code><div><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span>(<span class="hljs-params"></span>) </span>{
  wave.unshift(wave.pop())

  <span class="hljs-keyword">var</span> last = wave[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>

  wave[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = alpha * (wave[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][last])
    + beta * wave[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]
    - wave[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]

  wave[<span class="hljs-number">0</span>][last] = alpha * (wave[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] + wave[<span class="hljs-number">1</span>][last - <span class="hljs-number">1</span>])
    + beta * wave[<span class="hljs-number">1</span>][last]
    - wave[<span class="hljs-number">2</span>][last]

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>; x &lt; last; ++x) {
    wave[<span class="hljs-number">0</span>][x] = alpha * (wave[<span class="hljs-number">1</span>][x + <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][x - <span class="hljs-number">1</span>])
      + beta * wave[<span class="hljs-number">1</span>][x]
      - wave[<span class="hljs-number">2</span>][x]
  }
}
</div></code></pre>
<h2 data-line="242" class="code-line" id="%E3%83%87%E3%83%A2">デモ</h2>
<p data-line="243" class="code-line">キャンバスをクリックすると左端の固定端を動かして波を起こします。</p>
<p data-line="245" class="code-line">1フレーム毎にシミュレーションを4ステップ進めています。</p>
<script src="demo/waveequation/vec2.js"></script>
<script src="demo/waveequation/canvas.js"></script>
<script src="demo/waveequation/wave1d.js"></script>
<h2 data-line="251" class="code-line" id="%E5%95%8F%E9%A1%8C">問題</h2>
<h3 data-line="252" class="code-line" id="%E6%B3%A2%E3%81%8C%E6%B8%9B%E8%A1%B0%E3%81%97%E3%81%AA%E3%81%84">波が減衰しない</h3>
<p data-line="253" class="code-line">時間が経っても波が減衰しません。最初に出てきた波動方程式にはエネルギーの減衰についての項が無いためです。 <a href="http://heim.ifi.uio.no/~sverre/papers/2011_HolmNasholm-fractZener-JournAcoustSocAm.pdf">A causal and fractional all-frequency wave equation for lossy media</a> の式(10)でエネルギーの減衰について考慮された波動方程式が紹介されています。</p>
<p data-line="255" class="code-line">厳密なシミュレーションでなければ、各ステップで適当な減衰係数をかけることで雰囲気は出ます。</p>
<pre class="hljs"><code><div><span class="hljs-keyword">var</span> attenuation = <span class="hljs-number">0.996</span> <span class="hljs-comment">// 減衰係数。 0 &lt; attenuation &lt; 1</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">step</span>(<span class="hljs-params"></span>) </span>{
  wave.unshift(wave.pop())

  <span class="hljs-comment">// 固定端。</span>
  <span class="hljs-keyword">var</span> last = wave[<span class="hljs-number">0</span>].length - <span class="hljs-number">1</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> x = <span class="hljs-number">1</span>; x &lt; last; ++x) {
    wave[<span class="hljs-number">0</span>][x] = attenuation * (
      alpha * (wave[<span class="hljs-number">1</span>][x + <span class="hljs-number">1</span>] + wave[<span class="hljs-number">1</span>][x - <span class="hljs-number">1</span>])
      + beta * wave[<span class="hljs-number">1</span>][x]
      - wave[<span class="hljs-number">2</span>][x]
    )
  }
}
</div></code></pre>
<h3 data-line="275" class="code-line" id="%E3%82%AE%E3%83%96%E3%82%B9%E7%8F%BE%E8%B1%A1">ギブス現象</h3>
<p data-line="276" class="code-line">今回のデモでは無視できないほどの<a href="https://en.wikipedia.org/wiki/Gibbs_phenomenon">ギブス現象</a>が起こっています。ギブス現象の低減については <a href="http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.386.7325&amp;rep=rep1&amp;type=pdf">On the Gibbs phenomenon and its resolution</a> でいくつか手法が紹介されています。</p>
<h3 data-line="278" class="code-line" id="%E7%99%BA%E6%95%A3">発散</h3>
<p data-line="279" class="code-line"><eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>c</mi></mrow><annotation encoding="application/x-tex">c</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">c</span></span></span></span></eq> 、 <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>t</mi></mrow><annotation encoding="application/x-tex">dt</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">t</span></span></span></span></eq> 、 <eq><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>d</mi><mi>x</mi></mrow><annotation encoding="application/x-tex">dx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.69444em;"></span><span class="strut bottom" style="height:0.69444em;vertical-align:0em;"></span><span class="base"><span class="mord mathit">d</span><span class="mord mathit">x</span></span></span></span></eq> の値によってはシミュレーションが発散します。今回のシミュレーションは explicit な形になっているので implicit な形にすることが考えられます。</p>
<h2 data-line="281" class="code-line" id="%E5%8F%82%E8%80%83%E3%82%B5%E3%82%A4%E3%83%88">参考サイト</h2>
<ul>
<li data-line="282" class="code-line"><a href="https://en.wikipedia.org/wiki/Numerical_partial_differential_equations">Numerical partial differential equations - Wikipedia</a></li>
<li data-line="283" class="code-line"><a href="https://en.wikipedia.org/wiki/Finite_difference_coefficient">Finite difference coefficient - Wikipedia</a></li>
<li data-line="284" class="code-line"><a href="https://en.wikipedia.org/wiki/Acoustic_attenuation">Acoustic attenuation - Wikipedia</a></li>
<li data-line="285" class="code-line"><a href="http://www.cs.cmu.edu/~baraff/sigcourse/index.html">Physically Based Modeling</a></li>
</ul>

</body></html>
